# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

### Added

- Comprehensive MkDocs documentation with Material theme
- API documentation generation using mkdocstrings
- Enhanced GitHub project files and templates
- Automated documentation deployment via GitHub Actions
- Type hints throughout the codebase
- Modern pytest-based test suite
- Code quality tools (black, flake8, mypy)

### Changed

- Modernized project structure and packaging
- Updated Python version requirements to 3.10+
- Enhanced error handling and logging
- Improved CLI interface with better help text
- Updated README with comprehensive examples

### Fixed

- Various parsing edge cases and error conditions
- Path handling on Windows systems
- Unicode handling in patch content

## [1.0.0] - 2024-01-01

### Added

- Complete rewrite with modern Python practices
- Type annotations for better IDE support
- Comprehensive test coverage
- GitHub Actions CI/CD pipeline
- Development dependencies and tooling

### Changed

- Migrated to modern packaging with pyproject.toml
- Updated API to be more Pythonic
- Enhanced error reporting and debugging

### Removed

- Support for Python versions below 3.10
- Legacy compatibility code

## [1.16] - Previous Release

### Added

- Python 3 support, thanks to Yen Chi Hsuan (@yan12125)

### Fixed

- Various compatibility issues with Python 3

## [1.15] - Previous Release

### Added

- Project moved to GitHub
- Improved Git patch detection thanks to @mspncp
- Tests/data contains database of all possible patches
- Test suite scan now processes tests/data automatically

### Changed

- patch-1.15.zip archive is now executable
- API changes: setdebug() initializes logging and enables debug info

## [1.14.2] - Previous Release

### Added

- `--revert` option to apply patches in reverse order (unpatch)
- Support for broken patches generated by online Google Code editor
- PatchSet and Patch objects are now iterable
- New PatchSet.findfile() contains logic detecting filename to patch
- PatchSet.revert() method

### Changed

- Make directory based tests easier to create and run manually

### Fixed

- xnormpath with Windows paths on Linux (issue #24, found by Philippe Ombredanne)

## [1.13] - Previous Release

### Added

- Diffstat output now also shows size delta in bytes
- Added `--directory` (-d) option to specify root when applying patches
- Hunk headers produced by `diff -p` option are now parsed and accessible
- Hunk.desc field to access hunk headers content
- PatchSet.apply() gets `root` keyword argument for the working dir

### Changed

- Improve error message for missing files
- Improve documentation

## [1.12.11] - Major API Break

### Added

- patch.py can read patches from stdin
- patch.py can show nice histogram with --diffstat option
- Added detection of SVN, GIT and HG patch types
- Added error reporting for parsing functions and helpers
- Added normalization to filenames to protect against patching files using absolute paths

### Changed

- Unrecognized patches marked as PLAIN
- Parsing functions now return False if parsing failed
- Major API changes - ensure proper error handling

### Security

- Protection against patching files in parent directories

---

## Migration Guide

### From 1.x to 2.x

When upgrading from version 1.x to 2.x, please note the following breaking changes:

#### Python Version Requirements

- **Old**: Python 2.7+ and Python 3.4+
- **New**: Python 3.10+ only

#### API Changes

- All functions now return `PatchSet` objects or `False` (instead of `None`)
- Type hints are now included throughout the API
- Some internal methods have been renamed or removed

#### Installation

```bash
# Old installation
pip install patch

# New installation (same command, but updated package)
pip install patch>=2.0.0
```

#### Code Updates

```python
# Old code
import patch
ps = patch.PatchSet()
ps.parse(open('file.patch', 'rb'))

# New code (recommended)
import patch
ps = patch.fromfile('file.patch')
if ps:  # Check for success
    ps.apply()
```

### From Legacy to Modern Testing

#### Old Test Setup

```bash
python tests/run_tests.py
```

#### New Test Setup

```bash
# Install with development dependencies
pip install -e ".[dev]"

# Run modern test suite
python -m pytest tests_pytest/ -v

# Run with coverage
python -m pytest tests_pytest/ --cov=src/patch --cov-report=html
```

## Contributing

We welcome contributions! Please see our [Contributing Guide](../development/contributing.md) for details on:

- Setting up the development environment
- Running tests
- Code style guidelines
- Submitting pull requests

## Support

- **Documentation**: <https://astroair.github.io/python-patch/>
- **Issues**: <https://github.com/AstroAir/python-patch/issues>
- **Discussions**: <https://github.com/AstroAir/python-patch/discussions>

## License

This project is licensed under the MIT License - see the [License](license.md) page for details.
